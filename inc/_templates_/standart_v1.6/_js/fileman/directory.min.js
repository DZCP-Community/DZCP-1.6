function Directory(e,a,s,n){e||(e=""),this.fullPath=e,this.name=n||RoxyUtils.GetFilename(e),this.name||(this.name="My files"),this.path=RoxyUtils.GetPath(e),this.dirs=a||0,this.files=s||0,this.Show=function(){var t=this.GetHtml(),e=$('li[data-path="'+this.path+'"]');0==e.length?e=$("#pnlDirList"):(0==e.children("ul").length&&e.append("<ul></ul>"),e=e.children("ul")),e&&(e.append(t),this.SetEvents())},this.SetEvents=function(){var t=this.GetElement();RoxyFilemanConf.MOVEDIR&&t.draggable({helper:makeDragDir,start:startDragDir,cursorAt:{left:10,top:10},delay:200}),(t=t.children("div")).click(function(t){selectDir(this)}),t.bind("contextmenu",function(t){t.stopPropagation(),t.preventDefault(),closeMenus("file"),selectDir(this);var e=t.pageY-$("#menuDir").height();return e<0&&(e=0),$("#menuDir").css({top:e+"px",left:t.pageX+"px"}).show(),!1}),t.droppable({drop:moveObject,over:dragFileOver,out:dragFileOut}),(t=t.children(".dirPlus")).click(function(t){t.stopPropagation(),Directory.Parse($(this).closest("li").attr("data-path")).Expand()})},this.GetHtml=function(){var t='<li data-path="'+this.fullPath+'" data-dirs="'+this.dirs+'" data-files="'+this.files+'" data-name="'+this.name+'" class="directory">';return t+='<div><img src="images/fileman/'+(this.dirs>0?"dir-plus.png":"blank.gif")+'" class="dirPlus" width="9" height="9">',t+='<img src="images/fileman/folder.png" class="dir"><span class="name">'+this.name+" ("+this.files+")</span></div>",t+="</li>"},this.SetStatusBar=function(){$("#pnlStatus").html(this.files+" "+(1==this.files?t("file"):t("files")))},this.SetSelectedFile=function(t){if(t){var e=File.Parse(t);e&&selectFile(e.GetElement())}},this.Select=function(t){var e=this.GetElement();e.children("div").addClass("selected"),$('#pnlDirList li[data-path!="'+this.fullPath+'"] > div').removeClass("selected"),e.children("img.dir").prop("src","images/fileman/folder.png"),this.SetStatusBar();for(var i=this.GetParent();i;)i.Expand(!0),i=i.GetParent();this.Expand(!0),this.ListFiles(!0,t),setLastDir(this.fullPath)},this.GetElement=function(){return $('li[data-path="'+this.fullPath+'"]')},this.IsExpanded=function(){var t=this.GetElement().children("ul");return t&&t.is(":visible")},this.IsListed=function(){return $("#hdDir").val()==this.fullPath},this.GetExpanded=function(t){var e=new Array;return t||(t=$("#pnlDirList")),t.children("li").each(function(){var t=$(this).attr("data-path"),i=new Directory(t);i&&(i.IsExpanded()&&t&&e.push(t),e=e.concat(i.GetExpanded(i.GetElement().children("ul"))))}),e},this.RestoreExpanded=function(t){for(i=0;i<t.length;i++){var e=Directory.Parse(t[i]);e&&e.Expand(!0)}},this.GetParent=function(){return Directory.Parse(this.path)},this.SetOpened=function(){var t=this.GetElement();t.find("li").length<1?t.children("div").children(".dirPlus").prop("src","images/fileman/blank.gif"):this.IsExpanded()?t.children("div").children(".dirPlus").prop("src","images/fileman/dir-minus.png"):t.children("div").children(".dirPlus").prop("src","images/fileman/dir-plus.png")},this.Update=function(t){var e=this.GetElement();t&&(this.fullPath=t,this.name=RoxyUtils.GetFilename(t),this.name||(this.name="My files"),this.path=RoxyUtils.GetPath(t)),e.attr("data-path",this.fullPath),e.attr("data-dirs",this.dirs),e.attr("data-files",this.files),e.attr("data-name",this.name),e.children("div").children(".name").html(this.name+" ("+this.files+")"),this.SetOpened()},this.LoadAll=function(e){var a=this.GetExpanded(),s=RoxyFilemanConf.DIRLIST;if(s){$("#pnlLoadingDirs").show(),$("#pnlDirList").hide(),s=RoxyUtils.AddParam(s,"type",RoxyUtils.GetUrlParam("type"));var n=this;$.ajax({url:s,type:"POST",dataType:"json",async:!1,cache:!1,success:function(t){for($("#pnlDirList").children("li").remove(),i=0;i<t.length;i++){(s=new Directory(t[i].p,t[i].d,t[i].f,t[i].n)).Show()}var s;$("#pnlLoadingDirs").hide(),$("#pnlDirList").show(),n.RestoreExpanded(a),(s=Directory.Parse(e))&&s.Select()},error:function(e){$("#pnlLoadingDirs").hide(),$("#pnlDirList").show(),alert(t("E_LoadingAjax")+" "+RoxyFilemanConf.DIRLIST)}})}else alert(t("E_ActionDisabled"))},this.Expand=function(t){var e=this.GetElement().children("ul");this.IsExpanded()&&!t?e.hide():e.show(),this.SetOpened()},this.Create=function(e){if(!e)return!1;if(RoxyFilemanConf.CREATEDIR){var i=RoxyUtils.AddParam(RoxyFilemanConf.CREATEDIR,"d",this.fullPath);i=RoxyUtils.AddParam(i,"n",e);var a=this,s=!1;return $.ajax({url:i,type:"POST",data:{d:this.fullPath,n:e},dataType:"json",async:!1,cache:!1,success:function(t){"ok"==t.res.toLowerCase()?(a.LoadAll(RoxyUtils.MakePath(a.fullPath,e)),s=!0):alert(t.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+a.name)}}),s}alert(t("E_ActionDisabled"))},this.Delete=function(){if(RoxyFilemanConf.DELETEDIR){var e=RoxyUtils.AddParam(RoxyFilemanConf.DELETEDIR,"d",this.fullPath),i=this,a=!1;return $.ajax({url:e,type:"POST",data:{d:this.fullPath},dataType:"json",async:!1,cache:!1,success:function(t){if("ok"==t.res.toLowerCase()){var e=i.GetParent();e.dirs--,e.Update(),e.Select(),i.GetElement().remove(),a=!0}t.msg&&alert(t.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+i.name)}}),a}alert(t("E_ActionDisabled"))},this.Rename=function(e){if(!e)return!1;if(RoxyFilemanConf.RENAMEDIR){var i=RoxyUtils.AddParam(RoxyFilemanConf.RENAMEDIR,"d",this.fullPath);i=RoxyUtils.AddParam(i,"n",e);var a=this,s=!1;return $.ajax({url:i,type:"POST",data:{d:this.fullPath,n:e},dataType:"json",async:!1,cache:!1,success:function(t){if("ok"==t.res.toLowerCase()){var i=RoxyUtils.MakePath(a.path,e);a.Update(i),a.Select(),s=!0}t.msg&&alert(t.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+a.name)}}),s}alert(t("E_ActionDisabled"))},this.Copy=function(e){if(RoxyFilemanConf.COPYDIR){var i=RoxyUtils.AddParam(RoxyFilemanConf.COPYDIR,"d",this.fullPath);i=RoxyUtils.AddParam(i,"n",e);var a=!1;return $.ajax({url:i,type:"POST",data:{d:this.fullPath,n:e},dataType:"json",async:!1,cache:!1,success:function(t){if("ok"==t.res.toLowerCase()){var i=Directory.Parse(e);i&&i.LoadAll(i.fullPath),a=!0}t.msg&&alert(t.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+i)}}),a}alert(t("E_ActionDisabled"))},this.Move=function(e){if(!e)return!1;if(RoxyFilemanConf.MOVEDIR){var i=RoxyUtils.AddParam(RoxyFilemanConf.MOVEDIR,"d",this.fullPath);i=RoxyUtils.AddParam(i,"n",e);var a=this,s=!1;return $.ajax({url:i,type:"POST",data:{d:this.fullPath,n:e},dataType:"json",async:!1,cache:!1,success:function(t){"ok"==t.res.toLowerCase()&&(a.LoadAll(RoxyUtils.MakePath(e,a.name)),s=!0),t.msg&&alert(t.msg)},error:function(e){alert(t("E_LoadingAjax")+" "+a.name)}}),s}alert(t("E_ActionDisabled"))},this.ListFiles=function(t,e){$("#pnlLoading").show(),$("#pnlEmptyDir").hide(),$("#pnlFileList").hide(),$("#pnlSearchNoFiles").hide(),this.LoadFiles(t,e)},this.FilesLoaded=function(t,e){for(t=this.SortFiles(t),$("#pnlFileList").html(""),i=0;i<t.length;i++){t[i].Show()}$("#hdDir").val(this.fullPath),$("#pnlLoading").hide(),0==$("#pnlFileList").children("li").length&&$("#pnlEmptyDir").show(),this.files=$("#pnlFileList").children("li").length,this.Update(),this.SetStatusBar(),filterFiles(),switchView(),$("#pnlFileList").show(),this.SetSelectedFile(e)},this.LoadFiles=function(e,a){if(RoxyFilemanConf.FILESLIST){var s=new Array,n=RoxyFilemanConf.FILESLIST;n=RoxyUtils.AddParam(n,"d",this.fullPath),n=RoxyUtils.AddParam(n,"type",RoxyUtils.GetUrlParam("type"));var r=this;return!this.IsListed()||e?$.ajax({url:n,type:"POST",data:{d:this.fullPath,type:RoxyUtils.GetUrlParam("type")},dataType:"json",async:!0,cache:!1,success:function(t){for(i=0;i<t.length;i++)s.push(new File(t[i].p,t[i].s,t[i].t,t[i].w,t[i].h));r.FilesLoaded(s,a)},error:function(e){alert(t("E_LoadingAjax")+" "+n)}}):($("#pnlFileList li").each(function(){s.push(new File($(this).attr("data-path"),$(this).attr("data-size"),$(this).attr("data-time"),$(this).attr("data-w"),$(this).attr("data-h")))}),r.FilesLoaded(s,a)),s}alert(t("E_ActionDisabled"))},this.SortByName=function(t,e){return t.sort(function(t,i){var a="desc"==e?0:2;return(t=t.name.toLowerCase())>(i=i.name.toLowerCase())?-1+a:t<i?1-a:0}),t},this.SortBySize=function(t,e){return t.sort(function(t,i){var a="desc"==e?0:2;return(t=parseInt(t.size))>(i=parseInt(i.size))?-1+a:t<i?1-a:0}),t},this.SortByTime=function(t,e){return t.sort(function(t,i){var a="desc"==e?0:2;return(t=parseInt(t.time))>(i=parseInt(i.time))?-1+a:t<i?1-a:0}),t},this.SortFiles=function(t){var e=$("#ddlOrder").val();switch(e||(e="name"),e){case"size":t=this.SortBySize(t,"asc");break;case"size_desc":t=this.SortBySize(t,"desc");break;case"time":t=this.SortByTime(t,"asc");break;case"time_desc":t=this.SortByTime(t,"desc");break;case"name_desc":t=this.SortByName(t,"desc");break;default:t=this.SortByName(t,"asc")}return t}}Directory.Parse=function(t){var e=!1,i=$("#pnlDirList").find('li[data-path="'+t+'"]');return i.length>0&&(e=new Directory(i.attr("data-path"),i.attr("data-dirs"),i.attr("data-files"),i.attr("data-name"))),e};